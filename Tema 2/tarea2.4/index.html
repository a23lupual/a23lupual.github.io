
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://a23lupual.org/a23lupual/Tema%202/tarea2.4/">
      
      
        <link rel="prev" href="../tarea2.3/">
      
      
        <link rel="next" href="../tarea2.5/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>BALANCEO DE CARGA CON PROXY INVERSO EN NGINX - a23lupual</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#balanceo-de-carga-con-proxy-inverso-en-nginx" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="a23lupual" class="md-header__button md-logo" aria-label="a23lupual" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            a23lupual
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              BALANCEO DE CARGA CON PROXY INVERSO EN NGINX
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_2">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="a23lupual" class="md-nav__button md-logo" aria-label="a23lupual" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    a23lupual
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ¡Bienvenido! 🎉
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 2
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tema 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SERVIDOR NGINX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tarea2.2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.2 – Autenticación en Nginx
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tarea2.3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PROXY INVERSO CON NGINX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    BALANCEO DE CARGA CON PROXY INVERSO EN NGINX
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    BALANCEO DE CARGA CON PROXY INVERSO EN NGINX
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      1. INTRODUCCION
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. INTRODUCCION">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-proxy-inverso" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Proxy inverso
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-balanceador-de-carga" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 Balanceador de carga
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-tarea" class="md-nav__link">
    <span class="md-ellipsis">
      2. TAREA
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-configuraciones" class="md-nav__link">
    <span class="md-ellipsis">
      3. CONFIGURACIONES
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. CONFIGURACIONES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx-servidor-web-1" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx Servidor Web 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-servidor-2" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx Servidor 2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nginx Servidor 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#config-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Config Nginx
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-del-proxy-inverso" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del Proxy Inverso
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprobaciones" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobaciones
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comprobaciones">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comprobacion-del-balanceo-de-carga" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación del balanceo de carga
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprobacion-cuando-cae-un-servidor" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación cuando cae un servidor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cuestiones" class="md-nav__link">
    <span class="md-ellipsis">
      Cuestiones
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cuestiones">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-least-connections-least_conn" class="md-nav__link">
    <span class="md-ellipsis">
      1. Least connections (least_conn)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ip-hash-ip_hash" class="md-nav__link">
    <span class="md-ellipsis">
      2. IP Hash (ip_hash)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-least-time-menor-tiempo" class="md-nav__link">
    <span class="md-ellipsis">
      3. Least Time (Menor tiempo)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tarea2.5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica 2.5 - Proxy inverso y balanceo de carga con SSL en NGINX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tarea_ampliacion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuración de un servidor Nginx con Hosts Virtuales y directorios de usuario
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 3
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tema 3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%203/tarea3.1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PRACTICA 3.1.- INSTALACIÓN DE TOMCAT Y MAVEN PARA DESPLIEGUE DE APLICACIÓN JAVA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%203/tarea3.2.2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica 3.4: Despliegue de una aplicacion React en Netlify
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%203/tarea3.2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica 3.2: Despliegue de aplicaciones con Node Express
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%203/tarea3.3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tarea 3.5: Despliegue de una aplicación Flask (Python)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 4
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tema 4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%204/tarea4.1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Servidor DNS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 5
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tema 5
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%205/Tarea5.1_Git_GitHub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ejercicios Git y GitHub
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 6
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Tema 6
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema%206/practica_6.1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 6.1 - Dockerización del despliegue de una aplicación Node.js
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema%206/practica_6.2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 6.2 - Despliegue de una aplicación PHP con Nginx y MySQL usando Docker y docker-compose
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema%206/practica_6.3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 6.3 - Despliegue de servidores web con usuarios autenticados mediante LDAP usando Docker y docker-compose
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      1. INTRODUCCION
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. INTRODUCCION">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-proxy-inverso" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Proxy inverso
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-balanceador-de-carga" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 Balanceador de carga
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-tarea" class="md-nav__link">
    <span class="md-ellipsis">
      2. TAREA
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-configuraciones" class="md-nav__link">
    <span class="md-ellipsis">
      3. CONFIGURACIONES
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. CONFIGURACIONES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx-servidor-web-1" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx Servidor Web 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-servidor-2" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx Servidor 2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nginx Servidor 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#config-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Config Nginx
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-del-proxy-inverso" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del Proxy Inverso
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprobaciones" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobaciones
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comprobaciones">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comprobacion-del-balanceo-de-carga" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación del balanceo de carga
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprobacion-cuando-cae-un-servidor" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación cuando cae un servidor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cuestiones" class="md-nav__link">
    <span class="md-ellipsis">
      Cuestiones
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cuestiones">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-least-connections-least_conn" class="md-nav__link">
    <span class="md-ellipsis">
      1. Least connections (least_conn)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ip-hash-ip_hash" class="md-nav__link">
    <span class="md-ellipsis">
      2. IP Hash (ip_hash)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-least-time-menor-tiempo" class="md-nav__link">
    <span class="md-ellipsis">
      3. Least Time (Menor tiempo)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="balanceo-de-carga-con-proxy-inverso-en-nginx">BALANCEO DE CARGA CON PROXY INVERSO EN NGINX</h1>
<h2 id="1-introduccion">1. INTRODUCCION</h2>
<p>Para entender esta práctica primero debemos saber que es un proxy inverso y un balanceador de carga:</p>
<h3 id="11-proxy-inverso">1.1 Proxy inverso</h3>
<p>Un proxy inverso es un tipo de servidor que se encuentra entre el cliente y servidor y se encarga de recibir las peticiones y redireccionarlas al servidor web, para despues responder dicha solicitud.</p>
<h3 id="12-balanceador-de-carga">1.2 Balanceador de carga</h3>
<p>Un balanceador de carga, es un tipo de proxy inverso que además se encarga de distribuir las peticiones entre servidores para que así un solo servidor no se tenga que encargar de todas las solicitudees. Esto es necesario cuando un sitio necesita de varios servidores por la cantidad de peticiones que reciba o por la disposición geográfica del mismo; esta implementación aporta un nivel mayor de seguridad ya que al haber dos servidores dando las mismas respuestas, si uno cae ya sea por un ataque o por cualquier otro problema tendremos el otro resolviendo las peticiones mientras este esté caido. Y por último esto también mejora la experiencia del usuario ya que reduce la cantidad de errores percibidas por el usuario, detectando un servidor defectuoso y redireccionando las peticones a otro, y por otra parte reduciendo la velocidad de respuesta. </p>
<h2 id="2-tarea">2. TAREA</h2>
<p>Para esta práctica vamos a necesitar el proxy inverso de la práctica anteior, y replicar el servidor web que teniamos.</p>
<ul>
<li>Cada servidor web tendrá un sitio web específico para esta practica.<ul>
<li>El webserver2 tendrá un IP asignada de forma fija mediante la configuración DHCP.</li>
</ul>
</li>
<li>Cambiaremos la configuración del proxy inverso para que también haga el balanceo de carga.</li>
<li>Haremos las peticiones HTTP desde el navegador WEB de nuestra máquina anfitriona, accediendo a <code>http://balanceo</code>.</li>
</ul>
<h2 id="3-configuraciones">3. CONFIGURACIONES</h2>
<p>Primero necesitamos desenlazar la carpeta con la web que teniamos previamente <code>/etc/nginx/sites-enabled</code> y ejecutar <code>unlink nombre-archivo</code>.</p>
<h3 id="nginx-servidor-web-1">Nginx Servidor Web 1</h3>
<p>El primer servidor web será el servidor principal que hemos estado usando hasta ahora, donde tenemos instalado ya el servicio web.</p>
<p>Debemos configurar este servidor web para que sirva el siguiente <code>index.html</code> que debéis crear dentro de la carpeta <code>/var/www/webserver1/html</code>:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;es&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Web Server 1<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;</span>Esto es el webserver 1<span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Prueba de balanceo de carga recargando esta página<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>El nombre del sitio web que en los archivos correspondientes en sites-availables es webserver1. En donde escribiremos la siguiente configuración.</p>
<div class="highlight"><pre><span></span><code>server<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>listen<span class="w"> </span><span class="m">8080</span><span class="p">;</span>

<span class="w">    </span>server_name<span class="w"> </span>webserver1<span class="w"> </span>www.webserver1<span class="p">;</span>

<span class="w">    </span>root<span class="w"> </span>/var/www/webserver1/html<span class="p">;</span>
<span class="w">    </span>index<span class="w"> </span>index.md<span class="w"> </span>index.htm<span class="p">;</span>

<span class="w">    </span>location<span class="w"> </span>/<span class="w"> </span><span class="o">{</span><span class="w">            </span>
<span class="w">            </span>add_header<span class="w"> </span>Host<span class="w"> </span>servidor_web1_a23lupual<span class="p">;</span>
<span class="w">            </span>try_files<span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri</span>/<span class="w"> </span><span class="o">=</span><span class="m">404</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>Como veis el servidor escuchara el puerto 8080 y le añadiremos la cabecera Host: servidor_web1_a23lupual.</p>
<h3 id="nginx-servidor-2">Nginx Servidor 2</h3>
<p>En este servidor web debemos realizar una configuración idéntica al servidor web 1, pero cambiando webserver1 por webserver2 (también en el index.html), 
así como el nombre de la cabecera añadida, que será Serv_Web2_vuestronombre</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;es&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Web Server 2<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;</span>Esto es el webserver 2<span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Prueba de balanceo de carga recargando esta página<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<h5 id="config-nginx">Config Nginx</h5>
<div class="highlight"><pre><span></span><code>server<span class="w"> </span><span class="o">{</span>
<span class="w">        </span>listen<span class="w"> </span><span class="m">8080</span><span class="p">;</span>

<span class="w">        </span>server_name<span class="w"> </span>webserver2<span class="w"> </span>www.webserver2<span class="p">;</span>

<span class="w">        </span>root<span class="w"> </span>/var/www/webserver2/html<span class="p">;</span>
<span class="w">        </span>index<span class="w"> </span>index.md<span class="w"> </span>index.htm<span class="p">;</span>

<span class="w">        </span>location<span class="w"> </span>/<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>add_header<span class="w"> </span>Host<span class="w"> </span>servidor_web2_a23lupual<span class="p">;</span>
<span class="w">                </span>try_files<span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri</span>/<span class="w"> </span><span class="o">=</span><span class="m">404</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>Como podéis observar la configuración es casí idéntica, cambiando simplemente el nombre y la ruta.</p>
<h3 id="configuracion-del-proxy-inverso">Configuración del Proxy Inverso</h3>
<p>Tras haber realizado las configuraciones anteriores, ya tendremos los 2 servidores web listos, entre los cuales vamos a distribuir las peticiones.</p>
<p>Por tanto, deberemos configurar el servidor proxy para que haga uso de los servidores web y distribuya estas peticiones.</p>
<ul>
<li>Crearemos en sites-available el archivo de configuración <code>balanceo</code></li>
</ul>
<p>El cual tendrá el siguiente formato:</p>
<div class="highlight"><pre><span></span><code>upstream<span class="w"> </span>backend_hosts<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>random<span class="p">;</span>
<span class="w">            </span>server<span class="w"> </span>________:____<span class="p">;</span>
<span class="w">            </span>server<span class="w"> </span>________:____<span class="p">;</span>
<span class="o">}</span>
<span class="w">        </span>server<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>listen<span class="w"> </span><span class="m">80</span><span class="p">;</span>
<span class="w">            </span>server_name<span class="w"> </span>________<span class="p">;</span><span class="w">      </span>
<span class="w">            </span>location<span class="w"> </span>/<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>proxy_pass<span class="w"> </span>http://backend_hosts<span class="p">;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
</code></pre></div>
<p>Donde: </p>
<ul>
<li>upstream backend_hosts: son los servidores en los que se reparte la carga.</li>
<li>Colocaremos las ip de cada servidor, como su puerto.</li>
<li>A este grupo le pondremos un nombre que es backend_hosts.</li>
<li>El parametro random, es para que el balanceo sea aleatorio.</li>
</ul>
<p>Una vez configurado se vería así:</p>
<div class="highlight"><pre><span></span><code>upstream<span class="w"> </span>backend_hosts<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>random<span class="p">;</span>
<span class="w">            </span>server<span class="w"> </span><span class="m">192</span>.168.116.117:8080<span class="p">;</span>
<span class="w">            </span>server<span class="w"> </span><span class="m">192</span>.168.116.142:8080<span class="p">;</span>
<span class="o">}</span>
<span class="w">        </span>server<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>listen<span class="w"> </span><span class="m">80</span><span class="p">;</span>
<span class="w">            </span>server_name<span class="w"> </span>practica2_alberto<span class="p">;</span>
<span class="w">            </span>location<span class="w"> </span>/<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>add_header<span class="w"> </span>Host<span class="w"> </span>servidor_web2_a23lupual<span class="p">;</span>
<span class="w">                </span>proxy_pass<span class="w"> </span>http://backend_hosts<span class="p">;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
</code></pre></div>
<h2 id="comprobaciones">Comprobaciones</h2>
<h3 id="comprobacion-del-balanceo-de-carga">Comprobación del balanceo de carga</h3>
<p>Si accedeis a vuestro sitio web, debéis poder accediendo sin problemas:</p>
<ul>
<li>Recargar la página varias veces y veréis como se va alternando entre los dos servidores web.</li>
</ul>
<p>Como podemos ver el servidor proxy hace el valanceo y nos muestra las páginas:</p>
<p><img alt="'página server 1'" src="../../assets/imagenes/fotos2.4/foto_server2.png" /></p>
<p><img alt="'página server 2'" src="../../assets/imagenes/fotos2.4/foto_server.png" /></p>
<h3 id="comprobacion-cuando-cae-un-servidor">Comprobación cuando cae un servidor</h3>
<p>Nuestro balanceador de carga está constantemente monitorizando “la salud” de los servidores web. De esta forma, si uno deja de funcionar por cualquier 
razón, siempre enviará las solicitudes a los que queden “vivos”. Vamos a comprobarlo:</p>
<p>Para esto apagaremos el primer servidor con el comando <code>sudo poweroff</code></p>
<p><img alt="'apagando servidor 1'" src="../../assets/imagenes/fotos2.4/poweroff.png" /></p>
<p>Y como podemos ver el servidor 2 sigue funcionando sin problemas.</p>
<p><img alt="'servidor 2'" src="../../assets/imagenes/fotos2.4/server1_caido.png" /></p>
<h2 id="cuestiones">Cuestiones</h2>
<h3 id="1-least-connections-least_conn">1. Least connections (least_conn)</h3>
<p>Este método distribuye las peticiones a los servidores con menos carga, para así mejorar la eficiencia del balanceo de carga.</p>
<h3 id="2-ip-hash-ip_hash">2. IP Hash (ip_hash)</h3>
<p>Este método distribuye las peticiones a los servidores basándose en la IP del cliente, de esta forma si un cliente accede a un servidor, siempre se le redirigirá a ese servidor.</p>
<h3 id="3-least-time-menor-tiempo">3. Least Time (Menor tiempo)</h3>
<p>Este método distribuye las peticiones a los servidores con menos tiempo de respuesta, de esta forma se mejora la eficiencia del balanceo de carga.</p>
<ul>
<li>Si quiero añadir 2 servidores web más al balanceo de carga, describe detalladamente qué configuración habría que añadir y dónde.</li>
</ul>
<p>Para esto debemos ir al bloque de configuración upstream backend_hosts y al igual que hicimos anteriormente añadiremos dos líneas más de configuración:</p>
<div class="highlight"><pre><span></span><code>upstream<span class="w"> </span>backend_hosts<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>random<span class="p">;</span>
<span class="w">            </span>server<span class="w"> </span><span class="m">192</span>.168.116.117:8080<span class="p">;</span>
<span class="w">            </span>server<span class="w"> </span><span class="m">192</span>.168.116.142:8080<span class="p">;</span>

<span class="w">            </span>server<span class="w"> </span>nuevo_server1<span class="p">;</span>
<span class="w">            </span>server<span class="w"> </span>nuevo_server2<span class="p">;</span>
<span class="o">}</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>