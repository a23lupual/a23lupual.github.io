
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://a23lupual.org/a23lupual/Tema%202/tarea2.2/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../tarea2.3/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>Práctica 2.2 – Autenticación en Nginx - a23lupual</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-22-autenticacion-en-nginx" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="a23lupual" class="md-header__button md-logo" aria-label="a23lupual" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            a23lupual
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Práctica 2.2 – Autenticación en Nginx
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_2">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="a23lupual" class="md-nav__button md-logo" aria-label="a23lupual" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    a23lupual
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ¡Bienvenido! 🎉
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 2
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tema 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SERVIDOR NGINX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Práctica 2.2 – Autenticación en Nginx
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Práctica 2.2 – Autenticación en Nginx
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      Introducción
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#paquetes-necesarios" class="md-nav__link">
    <span class="md-ellipsis">
      Paquetes necesarios
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-usuarios-y-constrasenas-para-el-acceso-web" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de usuarios y constraseñas para el acceso web
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configurando-el-servidor-nginx-para-usar-autenticacion-basica" class="md-nav__link">
    <span class="md-ellipsis">
      Configurando el servidor Nginx para usar autenticación básica
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#probando-la-nueva-configuracion" class="md-nav__link">
    <span class="md-ellipsis">
      Probando la nueva configuración
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#combinacion-de-la-autenticacion-basica-con-la-restriccion-de-acceso-por-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Combinación de la autenticación básica con la restricción de acceso por IP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Combinación de la autenticación básica con la restricción de acceso por IP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#como-permitir-o-denegar-acceso-sobre-una-ip-concreta" class="md-nav__link">
    <span class="md-ellipsis">
      Como permitir o denegar acceso sobre una IP concreta.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tareas" class="md-nav__link">
    <span class="md-ellipsis">
      Tareas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tareas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-intenta-entrar-primero-con-un-usuario-erroneo-y-luego-con-otro-correcto-puedes-ver-todos-los-sucesos-y-registros-en-los-logs-accesslog-y-errorlog" class="md-nav__link">
    <span class="md-ellipsis">
      1. Intenta entrar primero con un usuario erróneo y luego con otro correcto. Puedes ver todos los sucesos y registros en los logs access.log y error.log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-borra-las-dos-lineas-que-hacen-referencia-a-la-autenticacion-basica-en-el-location-del-directorio-raiz-tras-ello-anade-un-nuevo-location-debajo-con-la-autenticacion-basica-para-el-archivoseccion-contacthtml-unicamente" class="md-nav__link">
    <span class="md-ellipsis">
      2. Borra las dos líneas que hacen referencia a la autenticación básica en el location del directorio raíz. Tras ello, añade un nuevo location debajo con la autenticación básica para el archivo/sección contact.html únicamente.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-configura-nginx-para-que-no-deje-acceder-con-la-ip-de-la-maquina-anfitriona-al-directorio-raiz-de-una-de-tus-dos-webs-modifica-su-server-block-o-archivo-de-configuracion-comprueba-como-se-deniega-el-acceso" class="md-nav__link">
    <span class="md-ellipsis">
      3. Configura Nginx para que no deje acceder con la IP de la máquina anfitriona al directorio raíz de una de tus dos webs. Modifica su server block o archivo de configuración. Comprueba como se deniega el acceso:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-configura-nginx-para-que-desde-tu-maquina-anfitriona-se-tenga-que-tener-tanto-una-ip-valida-como-un-usuario-valido-ambas-cosas-a-la-vez-y-comprueba-que-si-puede-acceder-sin-problemas" class="md-nav__link">
    <span class="md-ellipsis">
      4. Configura Nginx para que desde tu máquina anfitriona se tenga que tener tanto una IP válida como un usuario válido, ambas cosas a la vez, y comprueba que sí puede acceder sin problemas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tarea2.3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PROXY INVERSO CON NGINX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tarea2.4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BALANCEO DE CARGA CON PROXY INVERSO EN NGINX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tarea2.5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica 2.5 - Proxy inverso y balanceo de carga con SSL en NGINX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tarea_ampliacion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuración de un servidor Nginx con Hosts Virtuales y directorios de usuario
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 3
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tema 3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%203/tarea3.1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PRACTICA 3.1.- INSTALACIÓN DE TOMCAT Y MAVEN PARA DESPLIEGUE DE APLICACIÓN JAVA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%203/tarea3.2.2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica 3.4: Despliegue de una aplicacion React en Netlify
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%203/tarea3.2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica 3.2: Despliegue de aplicaciones con Node Express
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%203/tarea3.3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tarea 3.5: Despliegue de una aplicación Flask (Python)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 4
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tema 4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%204/tarea4.1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Servidor DNS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 5
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tema 5
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%205/Tarea5.1_Git_GitHub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ejercicios Git y GitHub
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 6
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Tema 6
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema%206/practica_6.1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 6.1 - Dockerización del despliegue de una aplicación Node.js
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema%206/practica_6.2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 6.2 - Despliegue de una aplicación PHP con Nginx y MySQL usando Docker y docker-compose
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema%206/practica_6.3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 6.3 - Despliegue de servidores web con usuarios autenticados mediante LDAP usando Docker y docker-compose
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      Introducción
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#paquetes-necesarios" class="md-nav__link">
    <span class="md-ellipsis">
      Paquetes necesarios
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-usuarios-y-constrasenas-para-el-acceso-web" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de usuarios y constraseñas para el acceso web
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configurando-el-servidor-nginx-para-usar-autenticacion-basica" class="md-nav__link">
    <span class="md-ellipsis">
      Configurando el servidor Nginx para usar autenticación básica
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#probando-la-nueva-configuracion" class="md-nav__link">
    <span class="md-ellipsis">
      Probando la nueva configuración
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#combinacion-de-la-autenticacion-basica-con-la-restriccion-de-acceso-por-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Combinación de la autenticación básica con la restricción de acceso por IP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Combinación de la autenticación básica con la restricción de acceso por IP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#como-permitir-o-denegar-acceso-sobre-una-ip-concreta" class="md-nav__link">
    <span class="md-ellipsis">
      Como permitir o denegar acceso sobre una IP concreta.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tareas" class="md-nav__link">
    <span class="md-ellipsis">
      Tareas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tareas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-intenta-entrar-primero-con-un-usuario-erroneo-y-luego-con-otro-correcto-puedes-ver-todos-los-sucesos-y-registros-en-los-logs-accesslog-y-errorlog" class="md-nav__link">
    <span class="md-ellipsis">
      1. Intenta entrar primero con un usuario erróneo y luego con otro correcto. Puedes ver todos los sucesos y registros en los logs access.log y error.log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-borra-las-dos-lineas-que-hacen-referencia-a-la-autenticacion-basica-en-el-location-del-directorio-raiz-tras-ello-anade-un-nuevo-location-debajo-con-la-autenticacion-basica-para-el-archivoseccion-contacthtml-unicamente" class="md-nav__link">
    <span class="md-ellipsis">
      2. Borra las dos líneas que hacen referencia a la autenticación básica en el location del directorio raíz. Tras ello, añade un nuevo location debajo con la autenticación básica para el archivo/sección contact.html únicamente.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-configura-nginx-para-que-no-deje-acceder-con-la-ip-de-la-maquina-anfitriona-al-directorio-raiz-de-una-de-tus-dos-webs-modifica-su-server-block-o-archivo-de-configuracion-comprueba-como-se-deniega-el-acceso" class="md-nav__link">
    <span class="md-ellipsis">
      3. Configura Nginx para que no deje acceder con la IP de la máquina anfitriona al directorio raíz de una de tus dos webs. Modifica su server block o archivo de configuración. Comprueba como se deniega el acceso:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-configura-nginx-para-que-desde-tu-maquina-anfitriona-se-tenga-que-tener-tanto-una-ip-valida-como-un-usuario-valido-ambas-cosas-a-la-vez-y-comprueba-que-si-puede-acceder-sin-problemas" class="md-nav__link">
    <span class="md-ellipsis">
      4. Configura Nginx para que desde tu máquina anfitriona se tenga que tener tanto una IP válida como un usuario válido, ambas cosas a la vez, y comprueba que sí puede acceder sin problemas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="practica-22-autenticacion-en-nginx">Práctica 2.2 – Autenticación en Nginx</h1>
<h2 id="introduccion">Introducción</h2>
<p>En una transacción HTTP, la autenticación de acceso básica es un método que permite a un navegador web u otro cliente proporcionar credenciales, como un nombre de usuario y una contraseña, al solicitar una página al servidor.</p>
<p>Como su nombre lo indica, la autenticación básica es el método más simple disponible para aplicaciones web. Fue definida originalmente en la especificación del protocolo HTTP y, aunque no es sofisticada, cumple su propósito.</p>
<p>Sin embargo, este tipo de autenticación presenta importantes vulnerabilidades de seguridad, lo que la hace poco recomendable en muchas situaciones. No requiere el uso de cookies, identificadores de sesión ni páginas de inicio de sesión.</p>
<h2 id="paquetes-necesarios">Paquetes necesarios</h2>
<p>Para esta práctica vamos a necesitar openssl para la creación de las claves.</p>
<p>En caso de no tenerlo instalado esté es el comando.</p>
<p><code>sudo apt install openssl</code></p>
<h2 id="creacion-de-usuarios-y-constrasenas-para-el-acceso-web">Creación de usuarios y constraseñas para el acceso web</h2>
<p>Para la creación de usuarios y contraseñas necesitaremos crear un archivo oculto llamado ".htpasswd" en el directorio de configuración /etc/nginx donde guardaremos nuestros usuarios y contraseñas.</p>
<p>Vamos a crear dos usuarios:</p>
<p>Para esto nos conectaremos a nuestra máquina a través de una conexión ssh:</p>
<p><img alt="Conexión ssh" src="../../assets/imagenes/fotos2.2/ssh.png" /></p>
<p>Para después crear los usuarios con el comando <code>sudo sh -c "echo -n 'vuestro_nombre:' &gt;&gt; /etc/nginx/.htpasswd"</code>:</p>
<p><img alt="'Creación de usuarios'" src="../../assets/imagenes/fotos2.2/cracion_usuarios.png" /></p>
<p>Y así se crea la constraseña:</p>
<p><img alt="'Creación de constraseñas'" src="../../assets/imagenes/fotos2.2/contrase%C3%B1as_openssl.png" /></p>
<h2 id="configurando-el-servidor-nginx-para-usar-autenticacion-basica">Configurando el servidor Nginx para usar autenticación básica</h2>
<p>Para configurar el servidor Nginx para usar autenticación básica editaremos la configuración del server block sobre el cual queremos aplicar la restricción de acceso:</p>
<p>Para esto usaremos nano: <code>sudo nano /etc/nginx/sites-available/nombre_web</code></p>
<p><img alt="'Archivo sites-availables'" src="../assets/imagenes/fotos2.2/" /></p>
<p>Lo primero será decidir qué recursos estarán protegidos. Nginx permite añadir restricciones a nivel de servidor o en un location (directorio o archivo) específico. Para nuestro ejemplo inicial vamos a proteger la raíz, la página principal de nuestro sitio.</p>
<p>Utilizaremos la directiva auth_basic dentro del location y le pondremos el nombre a nuestro dominio que será mostrado al usuario al solicitar las credenciales. Por último, configuramos Nginx para que utilice el fichero que previamente hemos creado con la directiva auth_basic_user_file : </p>
<p><code>location / {
    auth_basic  "Área restringida";
    auth_basic_user_file    /etc/nginx/.htpasswd;
        try_files $uri $uri/ =404;
}</code></p>
<p>Deberiamos acabar con un archivo parecido a este:</p>
<p><img alt="'Archivo sites-availables'" src="../../assets/imagenes/fotos2.2/sites-availables.png" /></p>
<p>Una vez terminada la configuración deberemos reiniciar el servicio:</p>
<p><code>sudo systemctl restart nginx.service</code></p>
<h2 id="probando-la-nueva-configuracion">Probando la nueva configuración</h2>
<p>Para esto desde la máquina física abriremos el navegador y bucamos <code>http://nombre-sitio-web</code>:</p>
<p><img alt="'Autenticacion en servidor'" src="../../assets/imagenes/fotos2.2/navegador.png" /></p>
<h2 id="combinacion-de-la-autenticacion-basica-con-la-restriccion-de-acceso-por-ip">Combinación de la autenticación básica con la restricción de acceso por IP</h2>
<p>Ha dos formas de integrar autenticación básica, ya sea por un usuario autenticado y tener IP válida o que el usuario estar bien autenticado o tener una ip válida.</p>
<h4 id="como-permitir-o-denegar-acceso-sobre-una-ip-concreta">Como permitir o denegar acceso sobre una IP concreta.</h4>
<p>Esto lo conseguiremos con las directivas <code>allow</code> y <code>deny</code>:</p>
<p><code>location /api {
    deny 192.168.1.2;
    allow 192.168.1.1/24;
    allow 127.0.0.1;
    deny all;
}</code></p>
<p>El acceso se garantizará a la IP 192.168.1.1/24, excluyendo a la dirección 192.168.1.2.</p>
<p>Hay que tener en cuenta que las directivas allow y deny se irán aplicando en el orden en el que aparecen el archivo.</p>
<p>Aquí aplican sobre la location /api (esto es solo un ejemplo de un hipotético directorio o archivo), pero podrían aplicar sobre cualquiera, incluida todo el sitio web, la location raíz /.</p>
<p>La última directiva deny all quiere decir que por defecto denegaremos el acceso a todo el mundo. Por eso hay que poner los allow y deny más específicos justo antes de esta, porque al evaluarse en orden de aparición, si los pusiéramos debajo se denegaría el acceso a todo el mundo, puesto que deny all sería lo primero que se evaluaría.</p>
<p>Combinar la restricción IP y la autenticación HTTP con la directiva satisfy.</p>
<p>Si establecemos el valor de la directiva a “all”, el acceso se permite si el cliente satisface ambas condiciones (IP y usuario válido). Si lo establecemos a “any”, el acceso se permite si se satisface al menos una de las dos condiciones.</p>
<p><code>location/api{
    satisfy all;
    deny 192.168.1.2;
    allow 192.168.1.1/24;
    allow 127.0.0.1;
    deny all;
    auth_basic  "Administrator's Area';
    auth_basic_usr_file conf/htpasswd;
}</code></p>
<h2 id="tareas">Tareas</h2>
<h3 id="1-intenta-entrar-primero-con-un-usuario-erroneo-y-luego-con-otro-correcto-puedes-ver-todos-los-sucesos-y-registros-en-los-logs-accesslog-y-errorlog">1.  Intenta entrar primero con un usuario erróneo y luego con otro correcto. Puedes ver       todos los sucesos y registros en los logs access.log y error.log</h3>
<div class="highlight"><pre><span></span><code>Adjunta una captura de pantalla de los logs donde se vea que intentas entrar primero con un usuario inválido y con otro válido. Indica dónde podemos ver los errores de usuario inválido o no encontrado, así como donde podemos ver el número de error que os aparecía antes
</code></pre></div>
<p>Vamos a intentar acceder con usuario que no existe como es 'Roberto' y luego vamos a comprobar el error en el log.</p>
<p><img alt="&quot;Archivo error.log&quot;" src="../../assets/imagenes/fotos2.2/error.png" /></p>
<h3 id="2-borra-las-dos-lineas-que-hacen-referencia-a-la-autenticacion-basica-en-el-location-del-directorio-raiz-tras-ello-anade-un-nuevo-location-debajo-con-la-autenticacion-basica-para-el-archivoseccion-contacthtml-unicamente">2.  Borra las dos líneas que hacen referencia a la autenticación básica en el location del directorio raíz. Tras ello, añade un nuevo location debajo con la autenticación básica para el archivo/sección contact.html únicamente.</h3>
<p>Para esto tendremos que borrar las dos lineas que hacer referencia a la autenticación básica en el directorio raiz. Luego añadiremos un nuevo location:</p>
<p><code>location /contact.html {
    auth_basic  "Área restringida";
    auth_basic_user_file    /etc/nginx/.htpasswd;
}</code></p>
<h3 id="3-configura-nginx-para-que-no-deje-acceder-con-la-ip-de-la-maquina-anfitriona-al-directorio-raiz-de-una-de-tus-dos-webs-modifica-su-server-block-o-archivo-de-configuracion-comprueba-como-se-deniega-el-acceso">3. Configura Nginx para que no deje acceder con la IP de la máquina anfitriona al directorio raíz de una de tus dos webs. Modifica su server block o archivo de configuración. Comprueba como se deniega el acceso:</h3>
<p>Para denegarle el acceso a nuestra máquina anfitriona simplemente tendremos que añadir la directiva deny como hemos visto antes con la ip de las misma en mi caso <code>192.168.164.110</code>, quedando así:</p>
<p><code>location / {
    deny 192.168.164.110/24;
    try_files $uri $uri/ =404;
}</code></p>
<p>Tras este cambio nos deberria aparecer esta página en el navegador:</p>
<p><img alt="&quot;Error 404&quot;" src="../../assets/imagenes/fotos2.2/error404.png" /></p>
<h3 id="4-configura-nginx-para-que-desde-tu-maquina-anfitriona-se-tenga-que-tener-tanto-una-ip-valida-como-un-usuario-valido-ambas-cosas-a-la-vez-y-comprueba-que-si-puede-acceder-sin-problemas">4. Configura Nginx para que desde tu máquina anfitriona se tenga que tener tanto una IP válida como un usuario válido, ambas cosas a la vez, y comprueba que sí puede acceder sin problemas</h3>
<p>Para conseguir esto tendremos que añadir las direcctivas allow <IP_MAQUINA> deny <all> para que así solo permita acceder a nuestra máquina. Quedaria de la siguiente manera:</p>
<p><code>location / {
    satisfy all;
    allow 192.168.164.110/24;
    deny all;
    auth_basic  "Área restringida";
    auth_basic_user_file    /etc/nginx/.htpasswd;
    try_files $uri $uri/ =404;
}</code></p>
<h1 id="cuestiones-finales">Cuestiones finales</h1>
<ol>
<li>
<p>Cuestion 1:</p>
</li>
<li>
<p>Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, equivocándome al poner el usuario y contraseña. ¿Podré acceder?¿Por qué?</p>
</li>
</ol>
<p><code>location /web_muy_guay {
    #...
    satisfy all;    
    deny  172.1.10.6;
    allow 172.1.10.15;
    allow 172.1.3.14;
    deny  all;
    auth_basic "Cuestión final 1";
    auth_basic_user_file conf/htpasswd;
}</code></p>
<p>No podrás acceder ya que aún habiendo una directiva que permite acceso a esa ip (<code>allow 172.1.10.15</code>), te has equivocado en la autenticación y esto te deniega el acceso con la directiva (<code>satisfy all</code>).</p>
<ol>
<li>Cuestion 2:</li>
</ol>
<p>Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, introduciendo correctamente usuario y contraseña. ¿Podré acceder? ¿Por qué?</p>
<p><code>location /web_muy_guay {
    #...
    satisfy all;    
    deny  all;
    deny  172.1.10.6;
    allow 172.1.10.15;
    allow 172.1.3.14;
    auth_basic "Cuestión final 2: The revenge";
    auth_basic_user_file conf/htpasswd;
}</code></p>
<p>No podrás acceder ya que tu IP está denegado por una directiva.</p>
<ol>
<li>Cuestion 3:</li>
</ol>
<p>Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, introduciendo correctamente usuario y contraseña. ¿Podré acceder? ¿Por qué?</p>
<p><code>location /web_muy_guay {
    #...
    satisfy any;    
    deny  172.1.10.6;
    deny 172.1.10.15;
    allow 172.1.3.14;
    auth_basic "Cuestión final 3: The final combat";
    auth_basic_user_file conf/htpasswd;
}</code></p>
<p>Si prodrás acceder ya que a pesar de que tu IP está denegada aparece la directiva <code>satify any</code> entonces cumplirias los requisitos.</p>
<ol>
<li>Cuestion 4:</li>
</ol>
<p>A lo mejor no sabéis que tengo una web para documentar todas mis excursiones espaciales con Jeff, es esta: Jeff Bezos y yo</p>
<p>Supongamos que quiero restringir el acceso al directorio de proyectos porque es muy secreto, eso quiere decir añadir autenticación básica a la URL:Proyectos</p>
<p>Completa la configuración para conseguirlo:</p>
<p><code>server {
listen 80;
listen [::]:80;
root /var/www/freewebsitetemplates.com/preview/space-science;
index index.html index.htm index.nginx-debian.html;
server_name freewebsitetemplates.com www.freewebsitetemplates.com;
location              {
    try_files $uri $uri/ =404;
    }
}</code></p>
<p>Para eso añadiremos configuraremos un nuevo location para ello:</p>
<p><code>server {
    listen 80;
    listen [::]:80;
    root /var/www/freewebsitetemplates.com/preview/space-science;
    index index.html index.htm index.nginx-debian.html;
    server_name freewebsitetemplates.com www.freewebsitetemplates.com;
    location  / {
        try_files $uri $uri/ =404;
        }
    location /project.html {
        satisfy all;
        allow 192.168.164.110/24;
        deny all;
        auth_basic  "Área restringida";
        auth_basic_user_file    /etc/nginx/.htpasswd;
        }
    }</code></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>